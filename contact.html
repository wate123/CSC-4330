<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>MODEL &mdash; Request Help Here</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Website Template by FreeHTML5.co" />
	<meta name="keywords" content="free website templates, free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />
	<meta name="author" content="FreeHTML5.co" />
	 <!--
	//////////////////////////////////////////////////////

	FREE HTML5 TEMPLATE
	DESIGNED & DEVELOPED by FREEHTML5.CO

	Website: 		http://freehtml5.co/
	Email: 			info@freehtml5.co
	Twitter: 		http://twitter.com/fh5co
	Facebook: 		https://www.facebook.com/fh5co

	//////////////////////////////////////////////////////
	 -->

  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700" rel="stylesheet">

	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Themify Icons-->
	<link rel="stylesheet" href="css/themify-icons.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">

	<!-- Owl Carousel  -->
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">

	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->
		<script src="admin/vendors/jquery/dist/jquery.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-firestore.js"></script>

		<script>
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyC4RrZ1ZAvMGLaDhGCB1TCfm4WzgdZT1cI",
			authDomain: "csc-4330.firebaseapp.com",
			databaseURL: "https://csc-4330.firebaseio.com",
			projectId: "csc-4330",
			storageBucket: "csc-4330.appspot.com",
			messagingSenderId: "549352708672"
		};
		firebase.initializeApp(config);
	</script>
	</head>
	<body>

	<div class="gtco-loader"></div>

	<div id="page">


	<div class="page-inner">
	<nav class="gtco-nav" role="navigation">
		<div class="gtco-container">

			<div class="row">
				<div class="col-sm-4 col-xs-12">
					<div id="gtco-logo"><a href="index.html">MODEL <em>.</em></a></div>
				</div>
				<div class="col-xs-8 text-right menu-1">
					<ul>
						<li><a href="features.html">Features</a></li>
						<li><a href="tour.html">FAQ</a></li>
						<li><a href="pricing.html">Need Help?</a></li>
						<li class="btn-cta"><a href="contact.html"><span>Make Request</span></a></li>
					</ul>
				</div>
			</div>

		</div>
	</nav>

	<header id="gtco-header" class="gtco-cover gtco-cover-sm" role="banner" style="background-image: url(images/request.jpg)">
		<div class="overlay"></div>
		<div class="gtco-container">
			<div class="row">
				<div class="col-md-12 col-md-offset-0 text-left">
					<div class="row row-mt-15em">

						<div class="col-md-7 mt-text animate-box" data-animate-effect="fadeInUp">
							<span class="intro-text-small">Need help?</span>
							<h1>Submit a request here.</h1>
						</div>

					</div>

				</div>
			</div>
		</div>
	</header>


	<div class="gtco-section border-bottom">
		<div class="gtco-container">
			<div class="row">
				<div class="col-md-12">
					<div class="col-md-6 animate-box">
					<h3>Submit Request</h3>
					<form id="request" action="#" method="post">
						<div class="row form-group">
							<div class="col-md-12">
								<label class="sr-only" for="name">Name</label>
								<input type="text" id="name" class="form-control" required="required" placeholder="Your firstname">
							</div>

						</div>

						<div class="row form-group">
							<div class="col-md-12">
								<label class="sr-only" for="email">Email</label>
								<input type="text" id="email" class="form-control" required="required" placeholder="Your email address">
							</div>
						</div>

						<div class="row form-group">
							<div class="col-md-12">
								<label class="sr-only" for="subject">Subject</label>
								<input type="text" id="subject" class="form-control" required="required"placeholder="Your subject of this message">
							</div>
						</div>

						<div class="row form-group">
							<div class="col-md-12">
								<label class="sr-only" for="message">Message</label>
								<textarea name="message" id="message" cols="30" rows="10" class="form-control" required="required" placeholder="Request description"></textarea>
							</div>
						</div>
						<div class="form-group">
							<input type="submit" value="Submit"  class="btn btn-primary">
						</div>

					</form>

				</div>
				
				</div>
			</div>
		</div>
	</div>

	<footer id="gtco-footer" role="contentinfo">
		<div class="gtco-container">
			<div class="row row-p	b-md">

				<div class="col-md-4">
					<div class="gtco-widget">
						<h3>About <span class="footer-logo">MODEL<span>.<span></span></h3>
						<p>MODEL Computing Services has provided this web-based system to give customers the ability to create requests in order get assistance in technical work. </p>
					</div>
				</div>

				<div class="col-md-4 col-md-push-1">
					<div class="gtco-widget">
						<h3>Links</h3>
						<ul class="gtco-footer-links">
							<li><a href="admin/production/adminLogin.html">Admin Access</a></li>
							<li><a href="admin/production/technicianLogin.html">Technician Access</a></li>
						</ul>
					</div>
				</div>

		

			</div>

			<div class="row copyright">
				<div class="col-md-12">
					<p class="pull-left">
						<small class="block">&copy; 2016 Free HTML5. All Rights Reserved.</small>
						<small class="block"> Demo Images: <a href="http://unsplash.co/" target="_blank">Unsplash</a></small>
					</p>
					
				</div>
			</div>

		</div>
	</footer>
	</div>

	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
	</div>

	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Carousel -->
	<script src="js/owl.carousel.min.js"></script>
	<!-- countTo -->
	<script src="js/jquery.countTo.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>
	<!-- Main -->
	<script src="js/main.js"></script>

    <script src="admin/vendors/validator/validator.js"></script>
	<script>
        var db = firebase.firestore();
        console.log(new Date().toLocaleString());
        $('#request').submit(function (e) {
            e.preventDefault();
            var name = document.getElementById("name").value.toLowerCase();
            var email = document.getElementById("email").value.toLowerCase();
            var subject = document.getElementById("subject").value;
            var message = document.getElementById("message").value;
            var idDoc = name + "-" + email;
            var difficulty = ['1-Easy','2-Medium','3-Hard'];
            var docRef = db.collection("queue").doc(idDoc);

            return db.runTransaction(function(transaction) {
                // This code may get re-run multiple times if there are conflicts.
                return transaction.get(docRef).then(function(doc) {
                        var calDiff = difficulty[Math.floor(Math.random() * difficulty.length)];
                        var timeNow = new Date().toLocaleString();
                        if (!doc.exists) {
                            docRef.set({
                                first: name.charAt(0).toUpperCase()+name.slice(1),
                                email: email,
                                subject: subject,
                                message: message,
                                count: 0,
                                difficulty: calDiff,
                                time: timeNow
                            });

                            console.log("Document does not exist!") ;
                        }else{
                            var newcount = doc.data().count + 1;
                            transaction.update(docRef, { count: newcount });
                            transaction.update(docRef, { subject: subject });
                            transaction.update(docRef, { message: message });
                            transaction.update(docRef, { time: timeNow });
                        }
                    }
                );
            }).then(function() {
                console.log("Transaction successfully committed!");
            }).catch(function(error) {
                console.log("Transaction failed: ", error);
            });

            // return db.runTransaction(function(transaction) {
            //     // This code may get re-run multiple times if there are conflicts.
            //     return transaction.get(UserdocRef).then(function(doc) {
            //             if (!doc.exists) {
            //                 UserdocRef.set({
            //                     first: name.charAt(0).toUpperCase()+name.slice(1),
            //                     email: email,
            //                     subject: subject,
            //                     message: message,
            //                     count: 0,
            //                     difficulty: calDiff,
            //                     time: timeNow
            //                 });
            //                 console.log("Document does not exist!") ;
            //             }else{
            //                 var newcount = doc.data().count + 1;
            //                 transaction.update(UserdocRef, { count: newcount });
            //                 transaction.update(UserdocRef, { subject: subject });
            //                 transaction.update(UserdocRef, { message: message });
            //                 transaction.update(UserdocRef, { time: timeNow });
            //             }
            //         }
            //     );
            // }).then(function() {
            //     location.reload();
            //     console.log("Transaction successfully committed!");
            // }).catch(function(error) {
            //     console.log("Transaction failed: ", error);
            // });

        });
	</script>
	</body>
</html>
