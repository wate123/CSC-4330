<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Technician Form </title>

    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.js"></script>
    <!--<script src="js/jquery.easing.1.3.js"></script>-->
    <!--<script src="js/jquery.waypoints.min.js"></script>-->
    <!--<script src="js/jquery.countTo.js"></script>-->
    <script src="../vendors/jQuery-Smart-Wizard/js/jquery.smartWizard.js"></script>

    <!-- jQuery Smart Wizard -->

    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-firestore.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyC4RrZ1ZAvMGLaDhGCB1TCfm4WzgdZT1cI",
            authDomain: "csc-4330.firebaseapp.com",
            databaseURL: "https://csc-4330.firebaseio.com",
            projectId: "csc-4330",
            storageBucket: "csc-4330.appspot.com",
            messagingSenderId: "549352708672"
        };
        firebase.initializeApp(config);
    </script>
  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;">
              <a href="../../index.html" class="site_title"><i class="fa fa-paw"></i> <span>Technician</span></a>
            </div>

            <div class="clearfix"></div>

            <!-- menu profile quick info -->
            <div class="profile clearfix">
              <div class="profile_pic">
                <img src="images/img.jpg" alt="..." class="img-circle profile_img">
              </div>
              <div class="profile_info">
                <span>Welcome,</span>
                <h2>Admin</h2>
              </div>
            </div>
            <!-- /menu profile quick info -->

            <br />

            <!-- sidebar menu -->
           <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
              <div class="menu_section">
                <h3>General</h3>
                <ul class="nav side-menu">
                  <li><a href="echarts.html"><i class="fa fa-bar-chart-o"></i> Assessment Tool</span></a>
                  <!--<li><a href="index.html"><i class="fa fa-home"></i> Home <span class="fa fa-chevron-down"></span></a>-->
                    <!--<ul class="nav child_menu">-->
                      <!--<li><a href="index.html">Dashboard</a></li>-->
                      <!--<li><a href="index2.html">Dashboard2</a></li>-->
                      <!--<li><a href="index3.html">Dashboard3</a></li>-->
                    <!--</ul>-->
                  <!--</li>-->
                  <li><a href="form_wizards.html"><i  class="fa fa-edit"></i> Technician </a>
                  </li>

                  </li>
                  <li><a href="tables_dynamic.html"><i  class="fa fa-table"></i>Table Dynamic</a></li>
                </ul>




                </div>

            </div>

            </div>
            <!-- /sidebar menu -->

            <!-- /menu footer buttons -->
            <div class="sidebar-footer hidden-small">
              <a data-toggle="tooltip" data-placement="top" title="Settings">
                <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="FullScreen">
                <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Lock">
                <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Logout" href="adminLogin.html">
                <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
              </a>
            </div>
            <!-- /menu footer buttons -->
          </div>
        </div>

        <!-- top navigation -->
        <div class="top_nav">
          <div class="nav_menu">
            <nav>
              <div class="nav toggle">
                <a id="menu_toggle"><i class="fa fa-bars"></i></a>
              </div>

              <ul class="nav navbar-nav navbar-right">
                <li class="">
                  <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <img src="images/img.jpg" alt="">Admin
                    <span class=" fa fa-angle-down"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-usermenu pull-right">
                    
                    <li><a href="../../index.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                  </ul>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>Technician Form</h3>
              </div>

            </div>
            <div class="clearfix"></div>

            <div class="row">

              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">


                    <!-- Smart Wizard -->
                    <div id="wizard" class="form_wizard wizard_horizontal">
                      <ul class="wizard_steps">
                        <li>
                          <a href="#step-1">
                            <span class="step_no">1</span>
                            <span class="step_descr">
                                              Step 1<br />
                                              <small>Create Account</small>
                                          </span>
                          </a>
                        </li>
                        <li>
                          <a href="#step-2">
                            <span class="step_no">2</span>
                            <span class="step_descr">
                                              Step 2<br />
                                              <small>Personal Information</small>
                                          </span>
                          </a>
                        </li>

                      </ul>
                      <div id="step-1">
                        <h2 class="StepTitle" align="center" style="font-size: large">Create Technician Account</h2>
                        <br>
                        <br>

                        <form id="account" class="form-horizontal form-label-left" style="height: 300px" method="post" novalidate>
                          <div class="item form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="email">Email <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                              <input type="email" id="email" name="email" required="required" class="form-control col-md-7 col-xs-12" >
                            </div>
                          </div>
                          <div class="col-md-6 col-md-offset-3">
                            <p id="confirmation" style="color:red; font-size: 15px"></p>

                          </div>
                          <div class="col-md-6 col-md-offset-3">
                            <button id="check" type="button"  class="btn btn-success">Check</button>
                          </div>
                          <br>
                          <div  id="after" >
                            <div id="passdiv" class="item form-group">

                              <label for="password" class="control-label col-md-3">Password*</label>
                              <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="password" type="password" name="password" data-validate-length="6,8" class="form-control col-md-7 col-xs-12" required="required">
                              </div>
                            </div>
                            <div id="pass2div" class="item form-group">
                              <label for="password2" class="control-label col-md-3 col-sm-3 col-xs-12">Repeat Password*</label>
                              <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="password2" type="password" name="password2"  data-validate-linked="password" class="form-control col-md-7 col-xs-12" required="required">
                              </div>
                            </div>

                            <div class="col-md-6 col-md-offset-3">
                              <p id="rest_confirmation" style="color:red; font-size: 15px"></p>

                            </div>
                            <div class="col-md-6 col-md-offset-3">
                              <button id="reset"  class="btn btn-primary" type="reset">Reset</button>
                              <script>
                                  $('#reset').click(function()  {
                                      location.reload();
                                  });
                              </script>
                            </div>
                          </div>




                        </form>

                        <script>
                            $("#after").hide();
                            // $("#pass2div").hide();
                            // $("#reset").hide();

                            document.getElementById('check').addEventListener('click',checkEmail, false);
                                function checkEmail() {
                                    var email = $('#email').val();
                                    if(email && email.length > 0){
                                        if(!isValidEmailAddress(email)){
                                            $('#confirmation').html('Email is invalid').show();
                                        }else{
                                            firebase.auth().fetchProvidersForEmail(email)
                                                .then((providers) => {
                                                    // return providers.length > 0;
                                                    console.log(providers.length);
                                                    if(providers.length == 0){
                                                        $('#confirmation').html('').hide();
                                                        $("#check").hide();
                                                        $("#after").show();
                                                        // $("#passdiv").show();
                                                        // $("#pass2div").show();
                                                        // $("#reset").show();
                                                    }else if(providers.length > 0){
                                                        $('#confirmation').html('Email already exist').show();
                                                    }
                                                });

                                        }
                                    }else{
                                        $('#confirmation').html('Please enter email').show();
                                    }
                                }
                            // Email Validation
                            function isValidEmailAddress(emailAddress) {
                                var pattern = new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);
                                return pattern.test(emailAddress);
                            }


                        </script>

                      </div>
                      <div id="step-2">
                        <h2 class="StepTitle" align="center" style="font-size: large">Personal Information</h2>
                        <br>
                        <br>
                        <form id="infomation"  class="form-horizontal form-label-left"  style="height: 300px" method="post" novalidate>
                          <div class="item form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">First Name <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                              <input id="first-name" class="form-control col-md-7 col-xs-12"  data-validate-words="1" name="name" placeholder="John" required="required" type="text">
                            </div>
                          </div>
                          <div class="item form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="last-name">Last Name <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                              <input id="last-name" class="form-control col-md-7 col-xs-12" data-validate-length-range="6" data-validate-words="1" name="name" placeholder="Doe" required="required" type="text">
                            </div>
                          </div>
                          <div class="item form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="age">Age <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                              <input type="number" id="age" name="number" required="required" data-validate-minmax="13,100" class="form-control col-md-7 col-xs-12">
                            </div>
                          </div>
                          <div class="item form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="telephone">Telephone <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                              <input type="tel" id="telephone" name="phone" pattern="phone" required="required" data-validate-length="8,20" class="form-control col-md-7 col-xs-12">
                            </div>
                          </div>
                          <div class="col-md-6 col-md-offset-3">
                            <button id="reset2"  class="btn btn-primary" type="reset">Reset</button>
                            <button type="button"   class="btn btn-primary">Submit</button>
                          </div>
                          <div class="col-md-6 col-md-offset-3">
                            <p id="confirmation2" style="color:red; font-size: 15px"></p>
                          </div>
                        </form>

                      </div>
                    </div>
                    <!-- End SmartWizard Content -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
      
        <!-- /footer content -->
      </div>
    </div>
    <script>

        //$('#submit').hide();
        $(document).ready(function(){
            // Smart Wizard
            $('#wizard').smartWizard({
                enableFinishButton: false,
                onLeaveStep:leaveAStepCallback,
                onFinish:onFinishCallback
            });

            function leaveAStepCallback(obj, context){
                console.log("Leaving step " + context.fromStep + " to go to step " + context.toStep);
                return validateSteps(context.fromStep); // return false to stay on step and true to continue navigation
            }

            function onFinishCallback(){
                if(validateAllSteps()){
                    firebase.auth().createUserWithEmailAndPassword($('#email').val(), $('#password2').val());
                    $('#infomation').click(function (e) {
                        console.log('submit');
                        e.preventDefault();
                        var db = firebase.firestore();
                        var fname = document.getElementById("first-name").value.toLowerCase();
                        var lname = document.getElementById("last-name").value.toLowerCase();
                        var age = document.getElementById("age").value;
                        var phone = document.getElementById("telephone").value;
                        var idDoc = fname+"-"+$('#email').val();
                        var docRef = db.collection("technician").doc(idDoc);
                        console.log(fname);
                        return db.runTransaction(function(transaction) {
                            // This code may get re-run multiple times if there are conflicts.
                            return transaction.get(docRef).then(function(doc) {
                                    if (!doc.exists) {
                                        docRef.set({
                                            first: fname.charAt(0).toUpperCase()+fname.slice(1),
                                            last: lname.charAt(0).toUpperCase()+fname.slice(1),
                                            age: age,
                                            phone: phone,
                                            time: new Date().toDateString()
                                        });
                                        console.log("Document does not exist!") ;
                                    }else{
                                        transaction.update(docRef, { first: fname.charAt(0).toUpperCase()+fname.slice(1) });
                                        transaction.update(docRef, { last: lname.charAt(0).toUpperCase()+fname.slice(1) });
                                        transaction.update(docRef, { age: age });
                                        transaction.update(docRef, { phone: phone });
                                        transaction.update(docRef, { time: new Date().toDateString() });
                                    }
                                }
                            );
                        }).then(function() {
                            location.reload();
                            console.log("Transaction successfully committed!");
                        }).catch(function(error) {
                            console.log("Transaction failed: ", error);
                        });
                    });
                }
            }


            function isTelephone(str) {
                var a = /^(1\s|1|)?((\(\d{3}\))|\d{3})(\-|\s)?(\d{3})(\-|\s)?(\d{4})$/.test(str);
            }

            function validateStep1() {
                var isValid = true;
                //validate email
                var email = $('#email').val();
                if(email && email.length > 0){
                    if(!isValidEmailAddress(email)){
                        isValid = false;
                        $('#rest_confirmation').html('Email is invalid').show();
                    }else{
                        //$('#rest_confirmation').html('').hide();

                    }
                }else{
                    isValid = false;
                    $('#rest_confirmation').html('Please enter email').show();
                }

                // validate password
                var pw = $('#password').val();
                var cpw = $('#password2').val();
                if(!pw || pw.length <= 0){
                    isValid = false;
                    $('#rest_confirmation').html('Please fill password').show();
                }else{
                    // validate confirm password

                    if(!cpw && cpw.length <= 0){
                        isValid = false;
                        $('#rest_confirmation').html('Please fill confirm password').show();
                    }else{
                        //$('#rest_confirmation').html('').hide();
                    }

                    //$('#rest_confirmation').html('').hide();
                }


                // validate password match
                if(pw && pw.length > 0 && cpw && cpw.length > 0){
                    if(pw !== cpw){
                        isValid = false;
                        $('#rest_confirmation').html('Password mismatch').show();
                    }
                }

                return isValid;
            }

            function validateStep2() {
                var isValid = true;
                //validate First name
                var fn = $('#first-name').val();
                if(!fn && fn.length <= 0){
                    isValid = false;
                    $('#confirmation2').html('Please fill First Name').show();
                }else{
                    //$('#confirmation2').html('').hide();
                    //validate Last name
                    var ln = $('#last-name').val();
                    if(!ln && ln.length <= 0){
                        isValid = false;
                        $('#confirmation2').html('Please fill Last Name').show();
                    }else{
                        //$('#confirmation2').html('').hide();
                    }
                }



                //validate Age
                var n = $('#age').val();
                if(!n){
                    isValid = false;
                    $('#confirmation2').html('Please fill age').show();
                }else if (isNaN(n) || parseInt(n,10) != n) {
                    isValid = false;
                    $('#confirmation2').html('Please enter integer').show();
                }else{
                    //$('#confirmation2').html('').hide();
                }
                //validate phone
                var phone = $('#telephone').val();
                if(phone && phone.length > 0){
                    if(isTelephone(phone)){
                        isValid = false;
                        $('#confirmation2').html('Phone number is invalid').show();
                    }else{
                        //$('#confirmation2').html('').hide();
                    }
                }else{
                    isValid = false;
                    $('#confirmation2').html('Please enter Phone Number').show();
                }

                if(!fn == !ln == false && !n && phone.length == 0){
                    $('#confirmation2').html('Please fill All Field').show();
                }
                return isValid;
            }
            // Your Step validation logic
            function validateSteps(stepnumber){
                var isStepValid = true;
                // validate step 1
                if(stepnumber === 1){
                    if (validateStep1() === false){
                        isStepValid = false;
                        $('#wizard').smartWizard('showMessage','Please correct the errors in step'+stepnumber+ ' and click next.');
                        $('#wizard').smartWizard('setError',{stepnum:stepnumber,iserror:true});
                    }else{
                        $('#wizard').smartWizard('hideMessage');
                        $('#wizard').smartWizard('setError',{stepnum:stepnumber,iserror:false});
                    }
                }
                if (stepnumber === 2){
                    if (validateStep2() === false){
                        isStepValid = false;
                        $('#wizard').smartWizard('showMessage','Please correct the errors in step'+stepnumber+ ' and click next.');
                        $('#wizard').smartWizard('setError',{stepnum:stepnumber,iserror:true});
                    }else{
                        $('#wizard').smartWizard('hideMessage');
                        $('#wizard').smartWizard('setError',{stepnum:stepnumber,iserror:false});
                    }
                }
                return isStepValid;
            }


            function validateAllSteps(){
                var isStepValid = true;
                if(validateStep1() == false){
                    isStepValid = false;
                    $('#wizard').smartWizard('setError',{stepnum:1,iserror:true});
                }else{
                    $('#wizard').smartWizard('setError',{stepnum:1,iserror:false});
                }

                if(validateStep2() == false){
                    isStepValid = false;
                    $('#wizard').smartWizard('setError',{stepnum:2,iserror:true});
                }else{
                    $('#wizard').smartWizard('setError',{stepnum:2,iserror:false});
                }

                if(!isStepValid){
                    $('#wizard').smartWizard('showMessage','Please correct the errors in the steps and continue');
                }                return isStepValid;
            }

        });
    </script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>

    <!-- Custom Theme Scripts -->
    <!-- validator -->
    <script src="../vendors/validator/validator.js"></script>


    <script src="../build/js/custom.js"></script>


  </body>
</html>